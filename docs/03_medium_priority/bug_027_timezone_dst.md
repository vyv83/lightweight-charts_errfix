# –ë–ê–ì #27: –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏ –∏ DST transitions

> **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  
> **Issue:** [#1189](https://github.com/tradingview/lightweight-charts/issues/1189)  
> **–°–≤—è–∑–∞–Ω–Ω—ã–µ Issues:** [#1426](https://github.com/tradingview/lightweight-charts/issues/1426), [#699](https://github.com/tradingview/lightweight-charts/issues/699)  
> **–í–µ—Ä—Å–∏–∏:** –í—Å–µ –≤–µ—Ä—Å–∏–∏  
> **–°—Ç–∞—Ç—É—Å:** üî¥ Open (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ - "By Design")  
> **–î–∞—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 18 —è–Ω–≤–∞—Ä—è 2026

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

Lightweight Charts **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–π–º–∑–æ–Ω—ã –Ω–∞—Ç–∏–≤–Ω–æ** - –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ãÃÅ–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–∞–∫ UTC. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º:

1. **DST –ø–µ—Ä–µ—Ö–æ–¥—ã (Daylight Saving Time)**: –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ timestamps –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å:
   - **–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –º–µ—Ç–∫–∏** - –∫–æ–≥–¥–∞ —á–∞—Å—ã –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –Ω–∞–∑–∞–¥ (–æ—Å–µ–Ω—å—é), –æ–¥–∏–Ω —á–∞—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
   - **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —á–∞—Å—ã** - –∫–æ–≥–¥–∞ —á–∞—Å—ã –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤–ø–µ—Ä—ë–¥ (–≤–µ—Å–Ω–æ–π), –æ–¥–∏–Ω —á–∞—Å "–∏—Å—á–µ–∑–∞–µ—Ç"
   - **–û—à–∏–±–∫–∏ –æ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö** - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

2. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**: –ú–µ—Ç–∫–∏ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æÃÅ–π –æ—Å–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç UTC –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

3. **–°–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞

1. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä—ã–Ω–∫–∏**: –¢—Ä–µ–π–¥–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–∞–π–º–∑–æ–Ω–∞—Ö (NYSE - EST, LSE - GMT, –∏ —Ç.–¥.)
2. **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–º—è –≤ —Ç–∞–π–º–∑–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ**: DST –ø—Ä–∞–≤–∏–ª–∞ –º–µ–Ω—è–ª–∏—Å—å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º, —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
4. **–û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö**: –ì—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç "–ª–æ–º–∞—Ç—å—Å—è" –¥–≤–∞ —Ä–∞–∑–∞ –≤ –≥–æ–¥ –ø—Ä–∏ DST –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è

```javascript
// –ü—Ä–æ–±–ª–µ–º–∞: –¥–∞–Ω–Ω—ã–µ –≤ UTC, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Europe/Moscow (UTC+3)
// –°–≤–µ—á–∞ –∑–∞ 2024-03-31T01:00:00Z (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è)

const data = [
  { time: 1711843200, open: 100, high: 101, low: 99, close: 100.5 }, // 01:00 UTC
  { time: 1711846800, open: 100.5, high: 102, low: 100, close: 101 }, // 02:00 UTC
  // –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:
  // 01:00 UTC -> 04:00 MSK
  // 02:00 UTC -> 05:00 MSK
  // –ù–æ –≤ –¥–µ–Ω—å –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –ª–µ—Ç–Ω–µ–µ –≤—Ä–µ–º—è —á–∞—Å—ã –ø—Ä—ã–≥–∞—é—Ç —Å 02:00 –Ω–∞ 03:00!
];

// –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ "–ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å" –≤—Ä–µ–º—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
const localizedData = data.map(bar => ({
  ...bar,
  time: bar.time + (3 * 3600), // –î–æ–±–∞–≤–ª—è–µ–º 3 —á–∞—Å–∞ –¥–ª—è MSK
}));
// –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¥–Ω–µ–π, –Ω–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ DST –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö
```

### –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–±–ª–µ–º—ã

- **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –≤ UTC —Ç–∞–π–º–∑–æ–Ω–µ
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è** –¥–≤–∞ —Ä–∞–∑–∞ –≤ –≥–æ–¥ –ø—Ä–∏ DST –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö
- –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç ~70% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–µ –≤ UTC)

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è timestamps —Å —É—á—ë—Ç–æ–º —Ç–∞–π–º–∑–æ–Ω—ã —á–µ—Ä–µ–∑ date-fns-tz

**–û—Ü–µ–Ω–∫–∞: 9/10** ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–û–ï

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ timestamp –≤ —Ü–µ–ª–µ–≤—É—é —Ç–∞–π–º–∑–æ–Ω—É —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `date-fns-tz`, –∫–æ—Ç–æ—Ä–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç DST.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ DST –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç IANA Time Zone Database
- –ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (~5KB gzipped)
- –¢—Ä–µ–±—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤ –≥—Ä–∞—Ñ–∏–∫

```javascript
import { toZonedTime, getTimezoneOffset } from 'date-fns-tz';

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç UTC timestamp –≤ "–ª–æ–∫–∞–ª—å–Ω—ã–π" timestamp –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ. Note: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å—ë –µ—â—ë Unix timestamp,
 * –Ω–æ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ lightweight-charts
 */
function convertToDisplayTimestamp(utcTimestamp, timeZone) {
  // –ü–æ–ª—É—á–∞–µ–º offset –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω—ã –≤ —ç—Ç–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
  const date = new Date(utcTimestamp * 1000);
  const offset = getTimezoneOffset(timeZone, date);
  
  // –î–æ–±–∞–≤–ª—è–µ–º offset (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö -> —Å–µ–∫—É–Ω–¥—ã)
  return utcTimestamp + (offset / 1000);
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const timeZone = 'America/New_York';
const convertedData = originalData.map(bar => ({
  ...bar,
  time: convertToDisplayTimestamp(bar.time, timeZone),
}));
```

---

### –†–µ—à–µ–Ω–∏–µ 2: Pure JavaScript —Å Intl.DateTimeFormat

**–û—Ü–µ–Ω–∫–∞: 8/10**

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–µ Intl API.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IANA —Ç–∞–π–º–∑–æ–Ω

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –≤ edge cases

```javascript
/**
 * –ü–æ–ª—É—á–∞–µ—Ç offset –¥–ª—è —Ç–∞–π–º–∑–æ–Ω—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
 */
function getTimezoneOffsetFor(date, timeZone) {
  // –°–æ–∑–¥–∞—ë–º —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è UTC –∏ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–π–º–∑–æ–Ω—ã
  const utcFormatter = new Intl.DateTimeFormat('en-US', {
    timeZone: 'UTC',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false,
  });
  
  const tzFormatter = new Intl.DateTimeFormat('en-US', {
    timeZone: timeZone,
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false,
  });
  
  // –ü–∞—Ä—Å–∏–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  const utcParts = parseFormattedDate(utcFormatter.format(date));
  const tzParts = parseFormattedDate(tzFormatter.format(date));
  
  // –°–æ–∑–¥–∞—ë–º Date –æ–±—ä–µ–∫—Ç—ã –∏ –ø–æ–ª—É—á–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É
  const utcDate = new Date(Date.UTC(
    utcParts.year, utcParts.month - 1, utcParts.day,
    utcParts.hour, utcParts.minute, utcParts.second
  ));
  const tzDate = new Date(Date.UTC(
    tzParts.year, tzParts.month - 1, tzParts.day,
    tzParts.hour, tzParts.minute, tzParts.second
  ));
  
  return tzDate.getTime() - utcDate.getTime();
}

function parseFormattedDate(formatted) {
  const [datePart, timePart] = formatted.split(', ');
  const [month, day, year] = datePart.split('/').map(Number);
  const [hour, minute, second] = timePart.split(':').map(Number);
  return { year, month, day, hour, minute, second };
}

// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
const offsetCache = new Map();

function getCachedOffset(timestamp, timeZone) {
  // –ö—ç—à–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º (offset –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ)
  const dayKey = `${timeZone}-${Math.floor(timestamp / 86400)}`;
  
  if (!offsetCache.has(dayKey)) {
    const date = new Date(timestamp * 1000);
    const offset = getTimezoneOffsetFor(date, timeZone);
    offsetCache.set(dayKey, offset);
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
    if (offsetCache.size > 1000) {
      const firstKey = offsetCache.keys().next().value;
      offsetCache.delete(firstKey);
    }
  }
  
  return offsetCache.get(dayKey);
}
```

---

### –†–µ—à–µ–Ω–∏–µ 3: Luxon –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏

**–û—Ü–µ–Ω–∫–∞: 8/10**

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Luxon (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ moment.js) –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–æ—â–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
- –û—Ç–ª–∏—á–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç DST
- –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä (~23KB gzipped)
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–ª–∏—à–Ω–∏–º —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏

```javascript
import { DateTime } from 'luxon';

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ
 */
function convertDataToTimezone(data, targetZone = 'local') {
  return data.map(bar => {
    // –°–æ–∑–¥–∞—ë–º DateTime –∏–∑ UTC timestamp
    const dt = DateTime.fromSeconds(bar.time, { zone: 'UTC' });
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ü–µ–ª–µ–≤—É—é —Ç–∞–π–º–∑–æ–Ω—É
    const localDt = targetZone === 'local' 
      ? dt.toLocal() 
      : dt.setZone(targetZone);
    
    // –ü–æ–ª—É—á–∞–µ–º "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π" UTC timestamp –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    // –≠—Ç–æ timestamp, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∫–∞–∫ UTC –ø–æ–∫–∞–∂–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
    const displayTime = localDt.toUTC().toSeconds() + localDt.offset * 60;
    
    return {
      ...bar,
      time: displayTime,
    };
  });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const localizedData = convertDataToTimezone(data, 'Europe/Moscow');
```

---

### –†–µ—à–µ–Ω–∏–µ 4: Custom timeFormatter –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–û—Ü–µ–Ω–∫–∞: 6/10**

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timeFormatter` –∏ `tickMarkFormatter` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–∫ –≤ –Ω—É–∂–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ, –Ω–µ –º–µ–Ω—è—è —Å–∞–º–∏ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è crosshair –∏ –º–µ—Ç–æ–∫

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é tick marks (–º–µ—Ç–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤ "–Ω–µ–∫—Ä–∞—Å–∏–≤—ã—Ö" –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≤—Ä–µ–º–µ–Ω–∞—Ö)
- –î–∞–Ω–Ω—ã–µ –≤—Å—ë –µ—â—ë –≤ UTC –≤–Ω—É—Ç—Ä–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å tick weight algorithm

```javascript
const chart = createChart(container, {
  localization: {
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ crosshair
    timeFormatter: (timestamp) => {
      const date = new Date(timestamp * 1000);
      return date.toLocaleTimeString('ru-RU', {
        timeZone: 'Europe/Moscow',
        hour: '2-digit',
        minute: '2-digit',
      });
    },
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
    dateFormat: 'dd.MM.yyyy',
  },
  timeScale: {
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–∫ –Ω–∞ –æ—Å–∏
    tickMarkFormatter: (timestamp, tickMarkType, locale) => {
      const date = new Date(timestamp * 1000);
      if (tickMarkType === 0) { // Year
        return date.toLocaleDateString('ru-RU', { 
          year: 'numeric',
          timeZone: 'Europe/Moscow',
        });
      }
      if (tickMarkType === 1) { // Month
        return date.toLocaleDateString('ru-RU', { 
          month: 'short',
          timeZone: 'Europe/Moscow',
        });
      }
      // ... continue for other tick types
      return date.toLocaleString('ru-RU', { timeZone: 'Europe/Moscow' });
    },
  },
});
```

---

### –†–µ—à–µ–Ω–∏–µ 5: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö + —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–û—Ü–µ–Ω–∫–∞: 10/10** ‚≠ê‚≠ê –õ–£–ß–®–ï–ï –†–ï–®–ï–ù–ò–ï

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è timestamps –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è + custom formatters –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Tick marks –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤ "–∫—Ä–∞—Å–∏–≤—ã—Ö" –ª–æ–∫–∞–ª—å–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–∞—Ö
- –ü–æ–ª–Ω–∞—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ DST
- Production-ready —Ä–µ—à–µ–Ω–∏–µ

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ü–æ–ª–Ω—ã–π –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```javascript
import { createChart } from 'lightweight-charts';
import { getTimezoneOffset } from 'date-fns-tz';

// ============================================
// –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏
// ============================================

/**
 * –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–∑–æ–Ω–∞–º–∏ –≤ Lightweight Charts
 */
class ChartTimezoneManager {
  constructor(targetTimezone = 'UTC') {
    this.timezone = targetTimezone;
    this.offsetCache = new Map();
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç offset –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ timestamp
   * @param {number} utcTimestamp - Unix timestamp –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
   * @returns {number} Offset –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
   */
  getOffset(utcTimestamp) {
    // –ö—ç—à–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (offset –æ–±—ã—á–Ω–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è)
    const dayKey = Math.floor(utcTimestamp / 86400);
    
    if (!this.offsetCache.has(dayKey)) {
      const date = new Date(utcTimestamp * 1000);
      // date-fns-tz –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç offset –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
      const offsetMs = getTimezoneOffset(this.timezone, date);
      this.offsetCache.set(dayKey, offsetMs / 1000);
    }
    
    return this.offsetCache.get(dayKey);
  }

  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç UTC timestamp –≤ "display" timestamp
   */
  toDisplayTime(utcTimestamp) {
    return utcTimestamp + this.getOffset(utcTimestamp);
  }

  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç "display" timestamp –æ–±—Ä–∞—Ç–Ω–æ –≤ UTC
   */
  toUtcTime(displayTimestamp) {
    // –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤)
    return displayTimestamp - this.getOffset(displayTimestamp);
  }

  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö
   */
  convertData(data) {
    return data.map(bar => ({
      ...bar,
      time: this.toDisplayTime(bar.time),
    }));
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ DST –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞–Ω–Ω—ã—Ö
   */
  hasDstTransition(data) {
    if (data.length < 2) return false;
    
    const offsets = data.map(bar => this.getOffset(bar.time));
    return new Set(offsets).size > 1;
  }

  /**
   * –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–π–º–∑–æ–Ω—É
   */
  setTimezone(newTimezone) {
    this.timezone = newTimezone;
    this.offsetCache.clear();
  }

  /**
   * –°–æ–∑–¥–∞—ë—Ç timeFormatter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ chart options
   */
  createTimeFormatter() {
    return (timestamp) => {
      // timestamp —É–∂–µ "—Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω", –Ω—É–∂–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ UTC
      const date = new Date(timestamp * 1000);
      return date.toLocaleTimeString('en-US', {
        timeZone: 'UTC', // –ü–æ—Ç–æ–º—É —á—Ç–æ –º—ã —É–∂–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–ª–∏ –≤—Ä–µ–º—è
        hour: '2-digit',
        minute: '2-digit',
        hour12: false,
      });
    };
  }

  /**
   * –°–æ–∑–¥–∞—ë—Ç tickMarkFormatter
   */
  createTickMarkFormatter() {
    return (timestamp, tickMarkType, locale) => {
      const date = new Date(timestamp * 1000);
      
      const formatOptions = {
        timeZone: 'UTC',
      };

      switch (tickMarkType) {
        case 0: // Year
          return date.toLocaleDateString(locale, { 
            ...formatOptions, 
            year: 'numeric' 
          });
        case 1: // Month
          return date.toLocaleDateString(locale, { 
            ...formatOptions, 
            month: 'short' 
          });
        case 2: // Day of Month
          return date.toLocaleDateString(locale, { 
            ...formatOptions, 
            day: 'numeric' 
          });
        case 3: // Time
          return date.toLocaleTimeString(locale, {
            ...formatOptions,
            hour: '2-digit',
            minute: '2-digit',
            hour12: false,
          });
        default:
          return date.toLocaleDateString(locale, formatOptions);
      }
    };
  }
}

// ============================================
// –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∞–π–º–∑–æ–Ω
// ============================================

function createTimezoneAwareChart(container, timezone = 'America/New_York') {
  const tzManager = new ChartTimezoneManager(timezone);

  const chart = createChart(container, {
    width: 800,
    height: 400,
    layout: {
      background: { type: 'solid', color: '#1E222D' },
      textColor: '#DDD',
    },
    grid: {
      vertLines: { color: '#2B2B43' },
      horzLines: { color: '#2B2B43' },
    },
    localization: {
      locale: 'en-US',
      timeFormatter: tzManager.createTimeFormatter(),
    },
    timeScale: {
      tickMarkFormatter: tzManager.createTickMarkFormatter(),
      timeVisible: true,
      secondsVisible: false,
    },
  });

  // –†–∞—Å—à–∏—Ä—è–µ–º API –≥—Ä–∞—Ñ–∏–∫–∞
  return {
    chart,
    tzManager,
    
    /**
     * –î–æ–±–∞–≤–ª—è–µ—Ç —Å–µ—Ä–∏—é —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
     */
    addTimezoneSeries(type, options = {}) {
      const addMethod = `add${type.charAt(0).toUpperCase() + type.slice(1)}Series`;
      const series = chart[addMethod](options);
      
      // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º setData
      const originalSetData = series.setData.bind(series);
      series.setData = (data) => {
        const convertedData = tzManager.convertData(data);
        originalSetData(convertedData);
      };
      
      // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º update
      const originalUpdate = series.update.bind(series);
      series.update = (bar) => {
        const convertedBar = {
          ...bar,
          time: tzManager.toDisplayTime(bar.time),
        };
        originalUpdate(convertedBar);
      };
      
      return series;
    },

    /**
     * –ò–∑–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–∑–æ–Ω—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
     */
    setTimezone(newTimezone, seriesDataMap) {
      tzManager.setTimezone(newTimezone);
      
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–µ—Ä–∏–∏
      for (const [series, originalData] of seriesDataMap) {
        const convertedData = tzManager.convertData(originalData);
        series.setData(convertedData);
      }
    },
  };
}

// ============================================
// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
// ============================================

// –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
const chartWrapper = createTimezoneAwareChart(
  document.getElementById('chart'),
  'Europe/Moscow'
);

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∏
const candleSeries = chartWrapper.addTimezoneSeries('candlestick', {
  upColor: '#26a69a',
  downColor: '#ef5350',
});

// –î–∞–Ω–Ω—ã–µ –≤ UTC
const data = [
  { time: 1704067200, open: 100, high: 102, low: 99, close: 101 },
  { time: 1704153600, open: 101, high: 104, low: 100, close: 103 },
  // ... –±–æ–ª–µ–µ –¥–∞–Ω–Ω—ã—Ö
];

// –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
candleSeries.setData(data);

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–π–º–∑–æ–Ω—ã
document.getElementById('tz-select').addEventListener('change', (e) => {
  chartWrapper.setTimezone(e.target.value, new Map([[candleSeries, data]]));
});
```

### React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∞–π–º–∑–æ–Ω

```tsx
import React, { useEffect, useRef, useState, useCallback } from 'react';
import { createChart, IChartApi, ISeriesApi } from 'lightweight-charts';
import { getTimezoneOffset } from 'date-fns-tz';

interface TimezoneChartProps {
  data: Array<{ time: number; value: number }>;
  timezone?: string;
  width?: number;
  height?: number;
}

export const TimezoneChart: React.FC<TimezoneChartProps> = ({
  data,
  timezone = 'UTC',
  width = 600,
  height = 400,
}) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const chartRef = useRef<IChartApi | null>(null);
  const seriesRef = useRef<ISeriesApi<'Line'> | null>(null);

  // –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
  const convertData = useCallback((rawData: typeof data, tz: string) => {
    return rawData.map(bar => {
      const date = new Date(bar.time * 1000);
      const offset = getTimezoneOffset(tz, date);
      return {
        ...bar,
        time: bar.time + (offset / 1000),
      };
    });
  }, []);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
  useEffect(() => {
    if (!containerRef.current) return;

    chartRef.current = createChart(containerRef.current, {
      width,
      height,
      layout: {
        background: { type: 'solid', color: '#1E222D' },
        textColor: '#DDD',
      },
      timeScale: {
        timeVisible: true,
      },
    });

    seriesRef.current = chartRef.current.addLineSeries({
      color: '#2962FF',
    });

    return () => {
      chartRef.current?.remove();
    };
  }, [width, height]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ data –∏–ª–∏ timezone
  useEffect(() => {
    if (!seriesRef.current || !data) return;

    const convertedData = convertData(data, timezone);
    seriesRef.current.setData(convertedData);
    chartRef.current?.timeScale().fitContent();
  }, [data, timezone, convertData]);

  return <div ref={containerRef} />;
};

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º —Ç–∞–π–º–∑–æ–Ω—ã
export const TimezoneChartWithSelector: React.FC<{ data: any[] }> = ({ data }) => {
  const [timezone, setTimezone] = useState('America/New_York');

  const timezones = [
    { value: 'UTC', label: 'UTC' },
    { value: 'America/New_York', label: 'New York (EST/EDT)' },
    { value: 'Europe/London', label: 'London (GMT/BST)' },
    { value: 'Europe/Moscow', label: 'Moscow (MSK)' },
    { value: 'Asia/Tokyo', label: 'Tokyo (JST)' },
    { value: 'Asia/Hong_Kong', label: 'Hong Kong (HKT)' },
  ];

  return (
    <div>
      <select value={timezone} onChange={(e) => setTimezone(e.target.value)}>
        {timezones.map(tz => (
          <option key={tz.value} value={tz.value}>{tz.label}</option>
        ))}
      </select>
      <TimezoneChart data={data} timezone={timezone} />
    </div>
  );
};
```

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ—à–µ–Ω–∏–π

| –ö—Ä–∏—Ç–µ—Ä–∏–π | date-fns-tz | Pure JS | Luxon | Formatters Only | –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π |
|----------|:-----------:|:-------:|:-----:|:---------------:|:---------------:|
| **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å DST** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ö†Ô∏è | ‚úÖ |
| **Tick marks –ø–æ–∑–∏—Ü–∏–∏** | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ |
| **–†–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | 5KB | 0KB | 23KB | 0KB | 5KB |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | ‚úÖ | ‚ö†Ô∏è | ‚úÖ | ‚úÖ | ‚ö†Ô∏è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ | ‚ö†Ô∏è | ‚úÖ | ‚úÖ | ‚úÖ |
| **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** | ‚úÖ | ‚ö†Ô∏è | ‚úÖ | ‚ö†Ô∏è | ‚úÖ |
| **–û—Ü–µ–Ω–∫–∞** | **9/10** | **8/10** | **8/10** | **6/10** | **10/10** |

---

## üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ DST –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è timestamps

–ü—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ (–æ—Å–µ–Ω—å—é) –æ–¥–∏–Ω —á–∞—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¥—É–±–ª–∏—Ä—É—é—â–∏–º—Å—è timestamps:

```javascript
// –ü—Ä–∏–º–µ—Ä: 27 –æ–∫—Ç—è–±—Ä—è 2024, –ø–µ—Ä–µ—Ö–æ–¥ —Å EEST –Ω–∞ EET –≤ Europe/Kyiv
// 03:00 -> 02:00 (—á–∞—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)

// –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ UTC timestamps –∏ –ù–ï –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∏—Ö
// –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

function handleDstAmbiguity(data, timezone) {
  const seen = new Set();
  
  return data.filter(bar => {
    const displayTime = convertToDisplayTime(bar.time, timezone);
    
    // –ï—Å–ª–∏ —Ç–∞–∫–æ–µ "–æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ" –≤—Ä–µ–º—è —É–∂–µ –µ—Å—Ç—å - —ç—Ç–æ DST –¥—É–±–ª–∏–∫–∞—Ç
    if (seen.has(displayTime)) {
      console.warn(`DST ambiguity detected at ${displayTime}`);
      // –û–ø—Ü–∏–∏:
      // 1. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (filter out)
      // 2. –°–º–µ—Å—Ç–∏—Ç—å –Ω–∞ 1 —Å–µ–∫—É–Ω–¥—É
      // 3. –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å (–¥–ª—è OHLC - –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å–≤–µ—á–∏)
      return false;
    }
    
    seen.add(displayTime);
    return true;
  });
}

// –ò–ª–∏: –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è —Å–≤–µ—á–µ–π
function aggregateDstDuplicates(data, timezone) {
  const aggregated = new Map();
  
  for (const bar of data) {
    const displayTime = convertToDisplayTime(bar.time, timezone);
    
    if (aggregated.has(displayTime)) {
      const existing = aggregated.get(displayTime);
      // –û–±—ä–µ–¥–∏–Ω—è–µ–º OHLC –¥–∞–Ω–Ω—ã–µ
      aggregated.set(displayTime, {
        time: displayTime,
        open: existing.open,
        high: Math.max(existing.high, bar.high),
        low: Math.min(existing.low, bar.low),
        close: bar.close,
        volume: (existing.volume || 0) + (bar.volume || 0),
      });
    } else {
      aggregated.set(displayTime, { ...bar, time: displayTime });
    }
  }
  
  return Array.from(aggregated.values());
}
```

---

## üîó –ò—Å—Ç–æ—á–Ω–∏–∫–∏

1. **GitHub Issue #1189** - [how to handle timezone and dst?](https://github.com/tradingview/lightweight-charts/issues/1189)
2. **Lightweight Charts Documentation** - [Time Zones Guide](https://tradingview.github.io/lightweight-charts/docs/time-zones)
3. **date-fns-tz** - [npm package](https://www.npmjs.com/package/date-fns-tz)
4. **Luxon** - [Documentation](https://moment.github.io/luxon/)
5. **Stack Overflow** - [Lightweight Charts timezone support](https://stackoverflow.com/questions/tagged/lightweight-charts+timezone)
6. **IANA Time Zone Database** - [tzdata](https://www.iana.org/time-zones)
7. **MDN** - [Intl.DateTimeFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ **–Ω–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç** –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–∞–π–º–∑–æ–Ω (by design)
- `date-fns-tz` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Intl` API –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç bundled timezone data
- –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª DST
- –î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 18 —è–Ω–≤–∞—Ä—è 2026*  
*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 18 —è–Ω–≤–∞—Ä—è 2026*
